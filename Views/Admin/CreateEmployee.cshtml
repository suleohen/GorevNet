@model GorevNet.Models.ViewModels.CreateEmployeeViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Yeni Personel Oluştur";
}

<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">
        <i class="fas fa-user-plus text-primary mr-2"></i>
        Yeni Personel Oluştur
    </h1>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Admin")">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("EmployeeManagement", "Admin")">Personel Yönetimi</a></li>
            <li class="breadcrumb-item active">Yeni Personel</li>
        </ol>
    </nav>
</div>

<!-- Success/Error Messages -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle mr-2"></i>
        @TempData["SuccessMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        @TempData["ErrorMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

<!-- Main Card -->
<div class="card shadow-lg border-0">
    <div class="card-header bg-gradient-primary text-white">
        <div class="row align-items-center">
            <div class="col">
                <h5 class="mb-0">
                    <i class="fas fa-user-plus mr-2"></i>
                    Personel Bilgileri
                </h5>
                <small class="text-white-50">Yeni personel için gerekli bilgileri doldurun</small>
            </div>
            <div class="col-auto">
                <div class="icon-circle bg-white text-primary">
                    <i class="fas fa-users"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="card-body p-4">
        <form asp-action="CreateEmployee" method="post" id="createEmployeeForm">
            @Html.AntiForgeryToken()

            <!-- Form validation hataları -->
            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-danger" role="alert">
                    <h6><i class="fas fa-exclamation-triangle mr-2"></i>Lütfen aşağıdaki hataları düzeltin:</h6>
                    @Html.ValidationSummary(true, "", new { @class = "mb-0" })
                </div>
            }

            <!-- Kişisel Bilgiler -->
            <div class="form-section mb-4">
                <h6 class="section-title text-primary mb-3">
                    <i class="fas fa-user mr-2"></i>
                    Kişisel Bilgiler
                </h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="FirstName" class="form-label font-weight-bold">
                                <i class="fas fa-user mr-1"></i>
                                Ad <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-user text-muted"></i></span>
                                </div>
                                <input asp-for="FirstName" class="form-control" placeholder="Adınızı giriniz" required />
                            </div>
                            <span asp-validation-for="FirstName" class="text-danger small"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="LastName" class="form-label font-weight-bold">
                                <i class="fas fa-user mr-1"></i>
                                Soyad <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-user text-muted"></i></span>
                                </div>
                                <input asp-for="LastName" class="form-control" placeholder="Soyadınızı giriniz" required />
                            </div>
                            <span asp-validation-for="LastName" class="text-danger small"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group">
                            <label asp-for="Email" class="form-label font-weight-bold">
                                <i class="fas fa-envelope mr-1"></i>
                                Email Adresi <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-envelope text-muted"></i></span>
                                </div>
                                <input asp-for="Email" type="email" class="form-control" required />
                            </div>
                            <span asp-validation-for="Email" class="text-danger small"></span>
                            <small class="form-text text-muted">Bu email adresi giriş yapmak için kullanılacaktır.</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="HireDate" class="form-label font-weight-bold">
                                <i class="fas fa-calendar mr-1"></i>
                                İşe Başlama Tarihi <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-calendar text-muted"></i></span>
                                </div>
                                <input asp-for="HireDate" type="date" class="form-control" required />
                            </div>
                            <span asp-validation-for="HireDate" class="text-danger small"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- İş Bilgileri -->
            <div class="form-section mb-4">
                <h6 class="section-title text-primary mb-3">
                    <i class="fas fa-briefcase mr-2"></i>
                    İş Bilgileri
                </h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Department" class="form-label font-weight-bold">
                                <i class="fas fa-building mr-1"></i>
                                Departman <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-building text-muted"></i></span>
                                </div>
                                <select asp-for="Department" asp-items="@(new SelectList(Model.Departments))"
                                        class="form-control custom-select" required>
                                    <option value="">-- Departman Seçiniz --</option>
                                </select>
                            </div>
                            <span asp-validation-for="Department" class="text-danger small"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Position" class="form-label font-weight-bold">
                                <i class="fas fa-user-tie mr-1"></i>
                                Pozisyon <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-user-tie text-muted"></i></span>
                                </div>
                                <input asp-for="Position" class="form-control" placeholder="Pozisyon giriniz" required />
                            </div>
                            <span asp-validation-for="Position" class="text-danger small"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Yetki Bilgileri -->
            <div class="form-section mb-4">
                <h6 class="section-title text-primary mb-3">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Yetki Bilgileri
                </h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Role" class="form-label font-weight-bold">
                                <i class="fas fa-user-shield mr-1"></i>
                                Kullanıcı Rolü <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-user-shield text-muted"></i></span>
                                </div>
                                <select asp-for="Role" asp-items="@(new SelectList(Model.Roles))"
                                        class="form-control custom-select" required>
                                    <option value="">-- Rol Seçiniz --</option>
                                </select>
                            </div>
                            <span asp-validation-for="Role" class="text-danger small"></span>
                            <small class="form-text text-muted">Bu rol, personelin sistemdeki yetkilerini belirler.</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-info border-left-info mt-4">
                            <div class="text-info">
                                <strong><i class="fas fa-info-circle mr-2"></i>Bilgi:</strong>
                                <ul class="mb-0 mt-2 small">
                                    <li><strong>Employee:</strong> Sadece kendi görevlerini görür</li>
                                    <li><strong>Manager:</strong> Departman yönetimi yetkisi</li>
                                    <li><strong>Admin:</strong> Tam yönetici yetkisi</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <hr class="my-4">
                <div class="row">
                    <div class="col-md-6">
                        <button type="submit" class="btn btn-primary btn-lg btn-block" id="submitBtn">
                            <i class="fas fa-save mr-2"></i>
                            <span class="btn-text">Personel Oluştur</span>
                            <span class="spinner-border spinner-border-sm d-none ml-2" role="status"></span>
                        </button>
                    </div>
                    <div class="col-md-6">
                        <a asp-action="EmployeeManagement" class="btn btn-secondary btn-lg btn-block">
                            <i class="fas fa-times mr-2"></i>
                            İptal
                        </a>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12 text-center">
                        <small class="text-muted">
                            <i class="fas fa-key mr-1"></i>
                            Oluşturulan personel için geçici şifre otomatik oluşturulacaktır.
                        </small>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Custom CSS -->
<style>
    .icon-circle {
        height: 3rem;
        width: 3rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }

    .form-section {
        background: #f8f9fc;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #4e73df;
    }

    .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e3e6f0;
    }

    .form-label {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        color: #5a5c69;
    }

    .input-group-text {
        background-color: #f8f9fc;
        border-color: #d1d3e2;
    }

    .form-control:focus {
        border-color: #4e73df;
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }

    .custom-select:focus {
        border-color: #4e73df;
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }

    .border-left-info {
        border-left: 0.25rem solid #36b9cc !important;
    }

    .btn-lg {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
    }

    .form-actions {
        background: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        border: 1px solid #e3e6f0;
    }

    .breadcrumb {
        background: transparent;
        padding: 0;
        margin: 0;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: ">";
        color: #858796;
    }

    .alert {
        border: none;
        border-radius: 0.5rem;
    }

    @@media (max-width: 768px) {
        .form-section {
            padding: 1rem;
        }
        
        .card-body {
            padding: 1.5rem !important;
        }
    }
</style>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        $(document).ready(function() {
            // Form submit animasyonu
            $('#createEmployeeForm').on('submit', function() {
                const $submitBtn = $('#submitBtn');
                const $btnText = $submitBtn.find('.btn-text');
                const $spinner = $submitBtn.find('.spinner-border');
                
                $submitBtn.prop('disabled', true);
                $btnText.text('Oluşturuluyor...');
                $spinner.removeClass('d-none');
            });

            // Input animasyonları
            $('.form-control, .custom-select').on('focus', function() {
                $(this).closest('.input-group').find('.input-group-text').addClass('border-primary');
            }).on('blur', function() {
                $(this).closest('.input-group').find('.input-group-text').removeClass('border-primary');
            });

            // HireDate için bugünün tarihini varsayılan olarak ayarla
            const today = new Date().toISOString().split('T')[0];
            if (!$('#HireDate').val()) {
                $('#HireDate').val(today);
            }

            // Email validation
            $('#Email').on('blur', function() {
                const email = $(this).val();
                const emailRegex = new RegExp('^[^\\s@@]+@@[^\\s@@]+\\.[^\\s@@]+

            // Form alanları için auto-complete önerileri
            $('#Position').on('input', function() {
                const commonPositions = [
                    'Yazılım Geliştirici', 'Sistem Yöneticisi', 'Proje Yöneticisi',
                    'İK Uzmanı', 'Muhasebe Uzmanı', 'Pazarlama Uzmanı',
                    'Satış Temsilcisi', 'Müdür', 'Uzman', 'Stajyer'
                ];
                
                // Basit auto-complete özelliği eklenebilir
            });

            // Alert otomatik kapanma
            $('.alert').each(function() {
                const $alert = $(this);
                setTimeout(function() {
                    $alert.fadeOut();
                }, 5000);
            });

            // Tooltips
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>
}
);
                const $inputGroup = $(this).closest('.input-group');
                
                if (email && !emailRegex.test(email)) {
                    $inputGroup.addClass('border-danger');
                    if (!$(this).next('.invalid-feedback').length) {
                        $(this).after('<div class="invalid-feedback d-block">Geçerli bir email adresi giriniz.</div>');
                    }
                } else {
                    $inputGroup.removeClass('border-danger');
                    $(this).next('.invalid-feedback').remove();
                }
            });

            // Form alanları için auto-complete önerileri
            $('#Position').on('input', function() {
                const commonPositions = [
                    'Yazılım Geliştirici', 'Sistem Yöneticisi', 'Proje Yöneticisi',
                    'İK Uzmanı', 'Muhasebe Uzmanı', 'Pazarlama Uzmanı',
                    'Satış Temsilcisi', 'Müdür', 'Uzman', 'Stajyer'
                ];
                
                // Basit auto-complete özelliği eklenebilir
            });

            // Alert otomatik kapanma
            $('.alert').each(function() {
                const $alert = $(this);
                setTimeout(function() {
                    $alert.fadeOut();
                }, 5000);
            });

            // Tooltips
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>
}